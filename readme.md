# B站视频字幕个人知识库助手

## 项目简介

本项目专注于抓取B站特定合集视频的字幕文件，例如积极心理学系列网课或知识博主如罗翔老师的课程字幕，进而利用这些字幕内容建立一个向量数据库。在此基础上，我们搭建了一个个人知识库助手，便于用户基于视频内容进行有效的检索和学习。

本项目核心开发基于LangChain框架，实现了从字幕提取、数据处理到向量数据库构建的完整流程。用户可通过本项目获取到的知识库进行快速查找和学习B站视频中的关键信息。

## 项目架构

### 整体架构

本项目的架构调整为专注于B站视频字幕的处理和知识检索，整体从视频字幕抓取到知识库构建如下：

![](../figures/structure_new.jpg)

① 数据获取层：专注于从B站视频获取字幕文本。

② 数据处理层：将抓取的字幕文本转换为结构化数据，并进行预处理。

③ 向量数据库层：使用提取的字幕内容建立向量数据库，便于后续的快速检索。

④ 应用层：基于向量数据库和LangChain构建的检索问答链，用户可以通过它对B站视频的内容进行查询和交互。

⑤ 服务层：通过Gradio或FastAPI提供的界面，使用户能够轻松使用这个个人助手。

### 代码结构

项目代码结构主要针对B站视频字幕处理进行优化：

    -project
        -readme.md 项目说明
        -bilibili 字幕抓取封装
            -subtitle_fetch.py 获取B站视频字幕
        -data 字幕数据处理
            -process_subtitle.py 字幕预处理和结构化
        -database 向量数据库封装
            -create_vector_db.py 基于字幕数据初始化向量数据库
        -chain 应用层封装
            -subtitle_qa_chain.py 基于字幕内容的检索问答链封装
        -serve 服务层封装
            -run_gradio.py 启动 Gradio 界面
            -api.py 封装 FastAPI
            -run_api.sh 启动 API

## 项目逻辑

1. 用户通过`run_gradio.py`或`run_api`启动服务；
2. 服务层调用`subtitle_qa_chain.py`实例化检索问答链，基于字幕内容实现问答和检索；
3. 利用`download.py`抓取B站特定视频的字幕,应用层通过调用`db.py`创建向量数据库,这个项目是想把抓取罗翔老师B站的法律课字幕，用来回答罗翔老师常举出的法律案例。
4. 用户可以通过Gradio界面或API与个人知识库助手互动，进行内容的查询和学习。

## 如何使用

1. 克隆项目到本地环境；
2. 安装必要的Python依赖；
3. 设置必要的API密钥和环境变量；
4. 运行`test.py`启动个人知识库助手服务；
5. 通过浏览器访问Gradio界面或通过API与助手进行交互。


